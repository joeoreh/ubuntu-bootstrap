# Ansible: базовая подготовка Ubuntu-сервера

Набор задач Ansible для "чистой" Ubuntu 22.04/24.04: создаёт отдельного пользователя, настраивает SSH, включает брандмауэр UFW, устанавливает полезные пакеты, включает автоматические обновления и Fail2Ban.

## Что делает
- создаёт пользователя "deploy" с sudo без пароля (можно переопределить);
- добавляет ваши SSH-ключи;
- отключает root‑логин по SSH и пароли (только ключи);
- ставит пакеты: "htop", "curl", "git", "ufw", "fail2ban", "unattended-upgrades";
- включает UFW и открывает 22/80/443 (меняется переменной);
- настраивает автоматические обновления;
- задаёт таймзону (по умолчанию "UTC").

> Цель — дать понятный и безопасный базовый старт. Всё описано переменными и работает идемпотентно.

## Быстрый старт
1) Установите Ansible на локальной машине.
2) Скопируйте репозиторий и укажите IP сервера в "inventory.ini".
3) Добавьте свой публичный SSH‑ключ в "vars.yml".
4) Запустите плейбук:

"""bash
ansible-playbook -i inventory.ini site.yml -u root
"""

После первого прохода можно подключаться новым пользователем (см. переменные).


## Настройка переменных ("vars.yml")
- "new_user": имя создаваемого пользователя (по умолчанию "deploy").
- "ssh_public_keys": список ваших публичных ключей.
- "disable_root_ssh": запрет root‑логина ("true/false").
- "timezone": таймзона ("UTC").
- "ufw_allowed_ports": список портов для UFW.
- "packages": дополнительные пакеты для установки.

## Пример инвентаря ("inventory.ini")
"""
[servers]
myserver ansible_host=203.0.113.10 ansible_user=root
"""

## Безопасность
- Плейбук отключает пароли в SSH. Если вам нужно оставить вход паролем — измените соответствующие флаги в задачах SSH.
- Fail2Ban ставится с дефолтной конфигурацией (подходит большинству случаев).

## Откат
Все изменения идут через конфиги и пакеты. Чтобы вернуть root‑логин/пароли — вручную поправьте "/etc/ssh/sshd_config" (или переиграйте задачи c нужными флагами) и перезапустите "sshd".

## Требования
- Контроллер: Ansible 2.14+
- Цель: Ubuntu 22.04/24.04
- Доступ по SSH

Лицензия: MIT.
